mixin form-group-standard(label, name, type, placeholder)
  .form-group
    label.col-lg-2.col-md-3.col-sm-4.control-label= label
    .col-lg-10.col-md-9.col-sm-8
      input.form-control(type=type, name=name, placeholder=placeholder, data-bind="value: $data.#{name}")

mixin form-group-checkbox(label, name, options)
  .form-group
    span.col-lg-2.col-md-3.col-sm-4.control-label= label
    .col-lg-10.col-md-9.col-sm-8
      each option in options
        label
          input(type="checkbox", name=name, value=option, data-bind="checkedValue: '#{option}', checked: $data['#{name}']")
          |  #{option}

mixin dl-item(label, databind)
  dt=label
  dd {{ #{databind} }}
extends layout

block content
  .container
    h1= title
    p Welcome to #{title}
    hr
    .row
      .col-xs-8
        .row.rooms(data-bind="foreach: {data: viewModel.rooms, as: 'roomId'}")
          div(data-bind="if: roomId")
            .panel.panel-default
              .panel-heading
                .btn-group.control-actions
                    a.btn.btn-success.btn-xs Start 
                    a.btn.btn-warning.btn-xs Restart
                    a.btn.btn-primary.btn-xs Update
                    a.btn.btn-danger.btn-xs Stop
                h3.panel-title(data-bind="text: roomId")
              .panel-body
                .row(data-bind="foreach: viewModel.stations().filter(function(item) { return roomId == item.settings.room() })")
                  .col-md-4
                    .panel.panel-primary
                      .panel-heading
                        .btn-group.control-actions
                            a.btn.btn-success.btn-xs Start 
                            a.btn.btn-warning.btn-xs Restart
                            a.btn.btn-primary.btn-xs Update
                            a.btn.btn-danger.btn-xs Stop
                        h2.panel-title(data-bind="text: $data.settings.nickname")
                      .panel-body
                        div(data-bind="editable: devices, editableOptions: {display: deviceDisplay, type: 'checklist', source: availableDevices, pk: 'unused', name: 'unused', url: '/api/stations/' + $data.settings.macaddress() + '/partial', params: {key: 'settings.roles'}}")
                        div(data-bind="editable: settings.roles, editableOptions: {display: roleDisplay, type: 'checklist', source: availableRoles, pk: 'unused', name: 'unused', url: '/api/stations/' + $data.settings.macaddress() + '/partial', params: {key: 'settings.roles'}}")
      .col-xs-4
        div
          button.btn.btn-default.btn-sm.pull-right(data-toggle="collapse", data-target="#add-station", type="button", form-toggle)
            | Add Station
          h3 Stations
          .collapse#add-station
            .panel.panel-default
              .panel-heading
                h3.panel-title New Station
              .panel-body
                form.form-horizontal.data-async(role="form", data-bind="with: {roles: [], room: null, nickname: null, record_path: null}")
                  legend.test-data Station Details
                  mixin form-group-standard("Mac Address", "macaddress", "text", "##:##:##:##:##:##")
                  mixin form-group-checkbox("Roles", "roles", ["mixer","ingest","record","stream"])
                  mixin form-group-standard("Nickname", "nickname", "text", "podium camera")
                  mixin form-group-standard("Room", "room", "text", "")
                  mixin form-group-standard("Record Path", "record_path", "text", "")
                  .form-group
                    .col-lg-offset-2.col-lg-10.col-md-offset-3.col-md-9.col-sm-offset-4.col-sm-8
                      button.btn.btn-default(type="submit", data-bind="click: submitStation") Submit
        ul.list-unstyled(data-bind="foreach: {data: stations, as: 'station'}, visible: true" style="display: none;")
          div(data-bind="ifnot: station.settings.room()")
            li
              button.btn.btn-default.btn-xs.pull-right(data-bind="click: removeStation", title="Forget Station")
                small
                 i.glyphicon.glyphicon-remove
              strong(data-bind="editable: settings.nickname, editableOptions: {pk: 'unused', name: 'unused', url: '/api/stations/' + $data.settings.macaddress() + '/partial', params: {key: 'settings.nickname'}}")
              |  
              small {{ macRewrite(settings.macaddress()) }}
              dl
                dt Room
                dd(data-bind="editable: settings.room, editableOptions: {pk: 'unused', name: 'unused', url: '/api/stations/' + $data.settings.macaddress() + '/partial', params: {key: 'settings.room'}}")
              ul.list-inline
                li(data-bind="foreach: {data: settings.roles, as: 'role'}, ")
                  span.label.label-info {{role}}
                  |  
